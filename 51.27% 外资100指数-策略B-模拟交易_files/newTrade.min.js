!function(e,t,c){function a(e){var t=c(this),a=e.data?e.data.operation:"",d=t.parents(".val-number-input").find("input"),n=parseInt(d.val()),i=c(".getNewAlgorithmDialog"),o=i.find('.jq-getNewAlgorithm-radio[name="month"]:checked'),r=o.attr("data-value"),l=o.attr("data-sale"),m=i.find(".js-getNewAlgorithmCount-down");"add"===a?n++:"cut"===a&&n--,1<n?m.removeClass("disabled"):m.addClass("disabled"),n<=0&&(d.val(1),n=1),"change"!==e.type||n||(d.val(1),n=1),i.find(".modal-body-item-val-amount").html(Math.round(l*r*n)),d.val(n),g()}function d(){var e,t=c(this),a=t.parents(".modal-body-item-val").find(".val-item"),d=t.parent();if("frequency"===t.attr("name")){e=t.val(),s.getNewTrade.data=u(s.data,e),s.getNewTrade.recommendFrequencyday="",s.getNewTrade.recommendFrequencytick="",s.getNewTrade.recommendFrequencyminute="",s.getNewTrade["recommendFrequency"+e.toLowerCase()]="checked";var n=c(".modal-content-html").html(),i=Mustache.render(n,{getNewTrade:s.getNewTrade});c(".getNewAlgorithmDialog .modal-content").html(i),c(".getNewAlgorithmDialog .modal-content").find("input[value="+s.data.recommendTime+"]").prop("checked",!0).parent().addClass("checked")}else{var o=t.attr("data-sale"),r=parseInt(c(".getNewAlgorithmDialog").find(".val-number-input input").val())||1,l=(e=parseInt(t.attr("data-value")))*o*r;a.removeClass("checked"),d.addClass("checked"),c(".getNewAlgorithmDialog").find(".modal-body-item-val-amount").html(Math.round(l)).attr("data-amount",l)}g()}function n(e){var n=c(this),i=e.data.type,o=c(".modal-content-html").html(),r="",l={};c("#myModal").modal("hide"),Cy.ajax(m,{success:function(e){var t=e.data,a=t.recommendFrequency;if(l.creditsAmount=t.creditsAmount.amount,l.recommendTime=t.recommendTime,"renewal"===i){var d=function(e,t){var a,d,n,i,o,r=e.parents("tr");return r.length?(a=r.find(".name").text(),d=e.attr("data-time"),n=r.find(".js-frequency").text().replace(/\s/g,""),e.parents(".popover").prev(".popover-bottom").popover("hide"),t.dataName=e.attr("data-name"),t.dataValue=e.attr("data-value"),o=r.find(".js-frequency").attr("data-frequency"),i=r.attr("data-backtestspaceid")):(a=e.attr("data-name"),d=e.attr("data-time"),i=e.attr("data-backtestspaceid"),n=c(".js-frequency").text().replace(/\s/g,""),t.dataName="backtestId",t.dataValue=e.attr("backtestId"),o=e.attr("data-frequency")),t.title="模拟交易位续费",t.buyWay="续费",t.renewal=!0,t.tradeName=a,t.tradeTime=d,t.frequency=n,t.backtestSpaceId=i,[t,o]}(n,l);l=d[0],a=d[1]}else l["recommendFrequency"+a]=t.recommendFrequency===a?"checked":"",l.title="获取新的模拟交易位",l.buyWay="新购买";a="day"===a?"Day":"minute"===a?"Minute":"Tick",l.data=u(t,a),s.data=t,s.getNewTrade=l,r=Mustache.render(o,{getNewTrade:l}),c(".getNewAlgorithmDialog .modal-content").html(r),c(".getNewAlgorithmDialog .modal-content").find("input[value="+t.recommendTime+"]").prop("checked",!0).parent().addClass("checked"),g(),c(".bs-example-modal-sm").modal("show")}})}function i(){var e={},t=c(this),a=t.attr("data-buyWay"),d=c(".getNewAlgorithmDialog"),n=d.find(".js-getNewAlgorithm-frequency").text().replace(/\s/g,"");t.attr("disabled",!0),e.frequency=d.find('.jq-getNewAlgorithm-radio[name="frequency"]:checked').val(),"续费"===a&&(e.renew=1,e[t.attr("data-name")]=t.attr("data-value"),e.backtestSpaceId=t.attr("data-backtestSpaceId")),e.frequency||(e.frequency="每天"===n?"Day":"分钟"===n?"Minute":"Tick"),e.month=d.find('.jq-getNewAlgorithm-radio[name="month"]:checked').val(),e.credits=d.find(".modal-body-item-val-amount").text().replace(/\s/g,""),e.count=d.find(".val-number-input input").val()||1,Cy.ajax(r,{data:e,success:function(e){console.log(e),"00000"===e.code?(c(".bs-example-modal-sm").modal("hide"),BootstrapDialog.show({title:"",cssClass:"changeTradeSpaceSucessDialog",message:"<p>购买成功</p>",onhidden:function(){window.location.reload()},onshow:function(e){setTimeout(function(){e.close()},2e3)}})):e.msg&&(c(".bs-example-modal-sm").modal("hide"),BootstrapDialog.show({title:"提示",message:e.msg,onhidden:function(){c(".bs-example-modal-sm").modal("show")}})),t.attr("disabled",!1)},fail:function(e){BootstrapDialog.show({title:"提示",message:e.msg})}})}var o=c(t),m="/credits/index/ChangeConfigForTrade",r="/algorithm/live/changeTradeSpaceByCredits",s={},g=function(){var e=c(".getNewAlgorithmDialog").find(".modal-body-item-val-amount").html(),t=c(".getNewAlgorithmDialog").find(".js-creditsAmount-span").html();if(!e)return c(".getNewAlgorithmDialog").find(".js-getNewAlgorithm-btn").addClass("btn-disabled").attr("disabled",!0),!1;parseInt(e)>parseInt(t)?(c(".getNewAlgorithmDialog").find(".js-creditsAmount").find(".modal-body-item-val-tips").removeClass("hidden"),c(".getNewAlgorithmDialog").find(".js-getNewAlgorithm-btn").addClass("btn-disabled").attr("disabled",!0)):(c(".getNewAlgorithmDialog").find(".js-creditsAmount").find(".modal-body-item-val-tips").addClass("hidden"),c(".getNewAlgorithmDialog").find(".js-getNewAlgorithm-btn").removeClass("btn-disabled").attr("disabled",!1))},u=function(e,t){var a={},d={1:"one",3:"three",6:"six",12:"twel"};for(var n in a.one=parseInt(e["base"+t]),t="Day"===t?"":t,d)1!==n&&(a[d[n]]=a.one*n),parseFloat(e[d[n]+"Sale"+t])<1&&(a[d[n]+"Sale"]=(10*e[d[n]+"Sale"+t]).toFixed(1)),a[d[n]+"SaleData"]=e[d[n]+"Sale"+t];return a.deductible=a[e.recommendTime],a[e.recommendTime+"Sale"]&&(a.deductible=Math.round(a.deductible*e[e.recommendTime+"Sale"+t])),a};o.delegate(".js-getNewAlgorithmCount-up","click",{operation:"add"},a),o.delegate(".js-getNewAlgorithmCount-down","click",{operation:"cut"},a),o.delegate(".getNewAlgorithmDialog .val-number-input input","change",a),o.delegate(".getNewAlgorithmDialog .val-number-input input","keyup",a),o.delegate(".jq-getNewAlgorithm-radio","change",d),o.delegate(".js-algorithm-renewal","click",{type:"renewal"},function(){var e=c(this),t=e.attr("data-backtestSpaceId");t&&(window.location.href="/view/credits/detail/4e3d70e55a915a8f9913b75816898146?backtestSpaceId="+t+"&direct=/algorithm/live/index?backtestId="+e.attr("backtestId"))}),o.delegate(".js-algorithm-buy","click",{type:"buy"},n),o.delegate(".js-getNewAlgorithm-btn","click",i),o.delegate(".js-gotoRecharge","click",function(){c(".bs-example-modal-sm").modal("hide"),window.open("/view/user/recharge")})}(window,document,jQuery);