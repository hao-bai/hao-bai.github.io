!function(n,t,d){function a(t){var a=d(t.target);a.parents(".fitObject").length||a.hasClass("fitObject")||r||(d(".applyDialog").find(".fitObject").find("ul").addClass("hidden"),r=!0,c())}function e(t){t=t||n.event;var a=d(t.target),e=d(t.currentTarget);a.hasClass("option")||(r=r?(e.find("ul").removeClass("hidden"),!1):(e.find("ul").addClass("hidden"),!0),c())}function i(t){var a=d(t.target),e=d(t.currentTarget),n=e.parents(".fitObject"),i=e.hasClass("disabled"),o=e.attr("data-value"),l=e.find(".option-text").html(),s=n.find(".applyContainer__item-input-value"),p=s.html(),r=n.find('input[name="Template[fitObject]"]'),c=r.val();i||a.hasClass("option-close")||o&&(c?(s.html(p+","+l),r.val(c+","+l)):(r.val(l),s.html(l)),e.addClass("disabled").find(".option-close").removeClass("hidden"))}function o(t){var a,e,n=d(t.target),i=n.prev().html(),o=n.parents(".fitObject"),l=(n.parent().attr("data-value"),o.find(".applyContainer__item-input-value")),s=l.html().split(","),p=o.find(".applyContainer__item-input-input");n.parent().removeClass("disabled"),n.addClass("hidden"),a=(s=s.filter(function(t){if(t!=i)return t})).length?s.join(","):"请选择策略适合对象",e=s.length?s.join(","):"",l.html(a),p.val(e)}function l(t){var a="1"!==d(t.target).val();d('input[name="Template[maxSubscribeCount]"]').attr("disabled",a),a&&d('input[name="Template[maxSubscribeCount]"]').val("")}function s(){var i=d("#backtestId").val(),t=d(".js-applyContainer").html().replace(/\n/g,"");return BootstrapDialog.show({title:"策略上架申请",message:t,cssClass:"applyDialog",buttons:[{label:"提交",cssClass:"applyDialogSubmit"},{label:"取消",action:function(t){t.close()}}],onshown:function(t){(window.ActiveXObject||"ActiveXObject"in window)&&t.$modalContent.find("textarea").val(""),d.Tipmsg.w.min="下限应小于上限！",d.Tipmsg.w.max="上限应大于下限！",d.Tipmsg.w["n0-3"]="请填写0到3位正整数！",t.$modalContent.Validform({btnSubmit:".applyDialogSubmit",tiptype:function(t,a,e){var n=d(a.obj).parent().find(".error_tips");t=3===a.type?"<span>"+t+"</span>":"",n.html(t)},datatype:{tags:function(t,a,e,n){var i=/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{1,10}$/,o=(t=t.replace(/,/g,"，")).split("，");if(t)for(var l=0;l<o.length;l++)if(!i.test(o[l]))return!1;return!0},"tags0-5":function(t,a,e,n){return(t=t.replace(/,/g,"，")).split("，").length<=5},specialS:function(t,a,e,n){return!/[~#^$@%&!?%*]/gi.test(t)},capital:function(t,a,e,n){return!t||!!/^[1-9]\d{0,9}$/.test(t)},min:function(t,a){var e=t,n=d(a).parent().find(".js-max").val();if(t&&parseInt(e)>parseInt(n))return!1},max:function(t,a){var e=t,n=d(a).parent().find(".js-min").val();if(t&&parseInt(n)>parseInt(e))return!1}},callback:function(t){var a=d(".applyDialog"),e=a.find(".applyContainer__input");if(a.find(".fitObject").find("input").val()){var o={"Template[type]":1,"Template[backtestId]":i};e.each(function(t,a){var e=d(a),n=e.attr("name"),i=e.val();n&&("Template[tags]"===n&&(i=i.replace(/,/g,"，")),"Template[price]"===n&&(i*=100),o[n]=i)});var n=a.find(".avgPositionCount").eq(0).val()+","+a.find(".avgPositionCount").eq(1).val();o["Template[avgPositionCount]"]=n,Cy.ajax("/algorithm/live/putawayTemplate",{data:o,success:function(t){return window.location.href="/algorithm/live/index?backtestId="+i,!1},fail:function(t){BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:t.msg})}})}else c()}}),d.Tipmsg.w.tags="单个标签不超过10个字，且不能为特殊字符",d.Tipmsg.w["tags1-5"]="请输入1到5个标签",d.Tipmsg.w.capital="请输入非0开头的十位以内的数字",d.Tipmsg.w.specialS="请勿输入特殊符号"}}),!1}var p=d("body"),r=!0,c=function(){var t=d(".applyDialog").find(".fitObject"),a=t.find("input").val(),e="<span>请选择策略适合对象！</span>",n=t.next(".error_tips");r&&(e=a?"":e,n.html(e))};d("#share-backtest-button").click(function(){var t=d("#backtest_name").html();return BootstrapDialog.show({title:"分享到策略擂台",cssClass:"btn-share-boot",message:'<div class="mb_20"><span class="vm">策略名称： </span><input id="name" type="text" value="'+t+'" ></div><div class="clear"><span style="vertical-align:top">策略思路： </span><textarea id="introduce" placeholder="请输入策略思路，便于大家了解您的策略" ></textarea><p class="bootips"><span style="color:#a2a6a9;">为了策略擂台的公平性，我们会将您的策略进行</span><span class="share_popover" style="color:#255da8;cursor:pointer">如下设置</span></p></div>',onshown:function(t){d(".share_popover").popover({placement:"bottom",trigger:"manual",html:!0,content:'<div class="popover-content-dev" ><p class="popover-content-title" >统一参数</p><p>基准： 沪深300</p><p>撮合方式： 盘口撮合。<a href="/view/community/detail/e47dcbe9f0088fca3aabe4fdaaf714cc" target="_blank">查看详细说明</a></p><p>手续费： 买入佣金万分之三，卖出时佣金万分之三加千分之一印花税</p><p class="popover-content-title" style="margin-top:12px">检查配置项</p><p>策略中使用过某些配置项时，将不允许分享到擂台。<a href="/help/api/help?name=api#experimental_settings" target="_blank">查看详细说明</a></p></div>'}).on("mouseenter",function(){var t=this;d(this).popover("show"),d(this).siblings(".popover").on("mouseleave",function(){d(t).popover("hide")})}).on("mouseleave",function(){var t=this;setTimeout(function(){d(".popover:hover").length||d(t).popover("hide")},100)}),d("#name").focus(function(){d(this).select()})},buttons:[{label:"取消",action:function(t){t.close()}},{label:"提交",cssClass:"btn-primary",action:function(a){var t=a.getModalBody().find("#name").val(),e=a.getModalBody().find("#introduce").val(),n=d("input[id=backtestId]").val();Cy.ajax("/algorithm/live/share",{data:"backtestId="+n+"&name="+encodeURIComponent(t)+"&introduce="+encodeURIComponent(e),async:!1,success:function(t){return window.location.reload(),!1},fail:function(t){0<=t.msg.indexOf("系统检查到策略中包含某些不允许开启的配置项")?(a.close(),BootstrapDialog.show({title:"提示",cssClass:"error-dialog",message:t.msg+'<a style="margin-left:10px;" href="/help/api/help?name=api#experimental_settings" target="_blank">查看详细说明</a>',buttons:[{label:"确定",action:function(t){t.close()}}]})):BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:t.msg})}})}}]}),!1});p.delegate(".applyContainer__item-input-option","click",i),p.delegate(".option-close","click",o),p.delegate(".fitObject","click",e),p.delegate(".ground","click",s),p.delegate(".modal-body","click",a),p.delegate("#enableSubscribe","change",l)}(window,0,jQuery);